# 库存管理工具系统架构设计文档 - 20240523

## 一、前端系统主体设计

### 1. 系统整体架构
- Web端采用响应式设计，兼容PC与主流移动浏览器。
- 主题风格：简洁明快，主色调蓝白，突出数据可视化。
- 主要页面：登录/注册、首页仪表盘、商品管理、库存管理、出入库管理、订单管理、告警中心、权限管理、个人中心、付费中心、操作日志、系统消息。
- 菜单栏：左侧固定，支持模块切换，顶部显示用户信息及快捷操作。
- 页面跳转：菜单点击切换主内容区，支持面包屑导航。

### 2. 各模块前端页面设计
- 登录/注册页：支持商家注册、登录、找回密码。
- 首页仪表盘：展示关键库存、订单、告警等数据概览，支持图表展示。
- 商品管理：商品列表、添加/编辑商品、批量导入导出（支持Excel/CSV）、商品详情。
- 库存管理：实时库存列表、库存详情、库存盘点、库存告警设置。
- 出入库管理：出入库记录列表、录入出库/入库单、明细查询、批量出入库。
- 订单管理：订单录入、订单列表、订单统计报表（支持导出Excel/CSV）、订单详情。
- 告警中心：库存预警、告警历史、告警处理。
- 权限管理：子账号管理、权限分配、角色编辑。
- 个人中心：账号信息、密码修改、联系方式维护。
- 付费中心：功能介绍、套餐选择、在线支付、续费记录。
- 操作日志：展示关键操作历史，支持筛选与导出。
- 系统消息：系统通知、告警推送、付费到期提醒等。

#### 移动端交互限制
- 仅支持数据浏览（商品、库存、订单、告警、消息等），所有编辑、导入导出、批量操作、权限管理、付费等功能仅限Web端。
- 移动端页面简化为仪表盘、商品/库存/订单列表、告警与消息浏览。

## 二、后端模块设计

| 模块名称     | 主要功能描述                     | 交互逻辑说明 | 异常处理逻辑 |
|------------|------------------------------|------------|------------|
| 用户与商家管理 | 注册、登录、商家信息维护、子账号管理 | 注册校验唯一性，登录鉴权，数据隔离 | 注册信息不全/重复、登录失败、权限不足 |
| 商品管理     | 商品增删改查、批量导入导出           | 商品唯一性校验，导入格式校验、异步处理大批量导入 | 商品重复、导入失败、数据格式错误 |
| 库存管理     | 实时库存维护、库存盘点、库存告警      | 出入库联动库存变更，盘点校准 | 库存不足、盘点冲突、告警未处理 |
| 出入库管理   | 出入库单录入、明细查询、批量出入库     | 校验库存、记录明细、异步处理大批量出入库 | 出库超库存、必填项缺失 |
| 订单管理     | 订单录入、订单统计、报表导出          | 订单与库存联动，统计聚合、异步导出报表 | 库存不足、订单录入失败 |
| 告警中心     | 库存预警、告警推送、历史记录          | 实时监控库存，推送告警 | 告警推送失败、处理超时 |
| 权限与角色管理 | 子账号创建、权限分配、角色管理         | 权限校验，操作日志 | 权限不足、操作失败 |
| 付费功能管理 | 付费套餐、功能开通、支付、续费         | 付费校验，功能开关，第三方支付回调 | 支付失败、套餐到期降级 |
| 操作日志     | 记录所有关键操作，支持查询与导出        | 自动记录、支持多条件筛选 | 日志丢失、查询失败 |
| 系统消息     | 系统通知、告警推送、付费提醒           | 消息推送、已读未读管理 | 推送失败 |

## 三、数据库设计

> **数据库类型：PostgreSQL（推荐13.x及以上）**
> - 主键建议使用 `bigserial` 或 `uuid`（如需分布式唯一性）。
> - 时间字段建议使用 `timestamp with time zone`。
> - 金额字段建议使用 `numeric` 类型，避免精度丢失。
> - 文本字段建议使用 `text` 或 `varchar(n)`。
> - 支持 JSONB 字段存储灵活扩展信息。
> - 支持数组类型和分区表优化大表。

### 1. 商家表 merchant
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 商家ID（主键） |
| name         | varchar(100) | 商家名称       |
| email        | varchar(100) | 邮箱         |
| phone        | varchar(20) | 联系电话       |
| password     | varchar(128) | 登录密码（加密）|
| status       | int     | 状态（正常/禁用）|
| created_at   | timestamp with time zone| 创建时间       |
| updated_at   | timestamp with time zone| 更新时间       |

**索引设计**：email唯一索引，phone唯一索引。

### 2. 用户表 user
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 用户ID（主键） |
| merchant_id  | bigint  | 所属商家ID     |
| username     | varchar(50) | 用户名         |
| password     | varchar(128) | 登录密码（加密）|
| role         | varchar(20) | 角色（管理员/员工）|
| status       | int     | 状态           |
| created_at   | timestamp with time zone| 创建时间       |
| updated_at   | timestamp with time zone| 更新时间       |

**索引设计**：merchant_id+username唯一索引。

### 3. 商品表 product
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 商品ID（主键） |
| merchant_id  | bigint  | 所属商家ID     |
| name         | varchar(100) | 商品名称       |
| sku          | varchar(50) | 商品SKU       |
| unit         | varchar(20) | 单位         |
| status       | int     | 状态         |
| created_at   | timestamp with time zone| 创建时间       |
| updated_at   | timestamp with time zone| 更新时间       |

**索引设计**：merchant_id+sku唯一索引，merchant_id+name索引。

### 4. 库存表 inventory
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 库存ID（主键） |
| product_id   | bigint  | 商品ID        |
| merchant_id  | bigint  | 所属商家ID     |
| quantity     | int     | 当前库存数量    |
| warning_line | int     | 库存告警下限    |
| updated_at   | timestamp with time zone| 更新时间       |

**索引设计**：merchant_id+product_id唯一索引。

### 5. 出入库记录表 stock_log
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 记录ID（主键） |
| product_id   | bigint  | 商品ID        |
| merchant_id  | bigint  | 所属商家ID     |
| user_id      | bigint  | 操作用户ID     |
| type         | varchar(10) | 类型（入库/出库）|
| quantity     | int     | 数量         |
| remark       | varchar(200) | 备注         |
| created_at   | timestamp with time zone| 操作时间       |

**索引设计**：merchant_id+product_id+created_at索引。

### 6. 订单表 order
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 订单ID（主键） |
| merchant_id  | bigint  | 所属商家ID     |
| user_id      | bigint  | 操作用户ID     |
| total_amount | numeric(18,2) | 订单总金额      |
| status       | int     | 状态         |
| created_at   | timestamp with time zone| 创建时间       |
| updated_at   | timestamp with time zone| 更新时间       |

**索引设计**：merchant_id+created_at索引。

### 7. 订单明细表 order_item
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 明细ID（主键） |
| order_id     | bigint  | 订单ID        |
| product_id   | bigint  | 商品ID        |
| quantity     | int     | 数量         |
| price        | numeric(18,2) | 单价         |

**索引设计**：order_id索引，product_id索引。

### 8. 付费记录表 payment
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 记录ID（主键） |
| merchant_id  | bigint  | 商家ID        |
| amount       | numeric(18,2) | 金额         |
| type         | varchar(20) | 类型（开通/续费）|
| status       | int     | 状态         |
| created_at   | timestamp with time zone| 创建时间       |

**索引设计**：merchant_id+created_at索引。

### 9. 操作日志表 operation_log
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 日志ID（主键） |
| merchant_id  | bigint  | 商家ID        |
| user_id      | bigint  | 用户ID        |
| action       | varchar(50) | 操作类型       |
| detail       | jsonb   | 操作详情       |
| created_at   | timestamp with time zone| 操作时间       |

**索引设计**：merchant_id+created_at索引。

### 10. 系统消息表 system_message
| 字段名         | 类型      | 说明         |
|--------------|---------|------------|
| id           | bigserial  | 消息ID（主键） |
| merchant_id  | bigint  | 商家ID        |
| type         | varchar(20) | 消息类型       |
| content      | jsonb   | 消息内容       |
| status       | int     | 已读/未读      |
| created_at   | timestamp with time zone| 创建时间       |

**索引设计**：merchant_id+status索引。

## 四、前后端接口设计

- 接口风格：RESTful API，基于 Flask 路由与 Blueprint 进行模块化管理。
- 数据交互格式：统一采用 JSON。
- 鉴权方式：JWT（推荐 flask-jwt-extended）。
- 异步任务：推荐 Celery + Redis 作为任务队列与消息中间件。
- 文件上传：推荐 flask-upload/flask-restful + 阿里云/腾讯云 OSS SDK。
- 日志与监控：flask-logging、sentry-sdk、Prometheus exporter。
- API文档：推荐使用 flask-restx 或 apispec 自动生成 Swagger 文档。

## 五、技术选型
- 前端：React + Ant Design + Axios + ECharts
- 后端：**Python + Flask**
  - 路由与接口：Flask + Flask-RESTful/Flask-Restx
  - ORM：SQLAlchemy（推荐结合 Flask-Migrate 做数据库迁移）
  - 鉴权：Flask-JWT-Extended
  - 配置管理：Flask-Config
  - 异步任务：Celery + Redis
  - 文件上传：Flask-Uploads/Flask-RESTful + 云存储SDK
  - 日志与监控：Flask-Logging、Sentry、Prometheus
  - API文档：Flask-Restx/Swagger
- 数据库：PostgreSQL
- 缓存：Redis（加速高频查询、会话管理）
- 部署：Docker 容器化，Nginx 反向代理
- 自动化测试：Pytest（后端）、Jest（前端）、Postman/Newman（接口）
- CI/CD：GitHub Actions、Jenkins、Docker Registry

## 六、环境部署
- 推荐使用Docker Compose一键部署前后端及数据库、缓存服务。
- 支持本地开发与生产环境分离配置。
- 日志与监控：接入ELK或Prometheus+Grafana。
- 生产环境建议开启HTTPS，数据库定期备份。
- 高可用建议：PostgreSQL主从、读写分离，Redis哨兵，Nginx负载均衡，定期自动备份与灾备演练。
- 自动化测试与CI/CD：推送代码自动触发测试与构建，自动部署到测试/生产环境。

## 七、项目开发计划

### 1. 项目准备阶段（1周）
- 明确需求与MVP范围，确认技术选型与架构方案
- 搭建代码仓库、CI/CD流程、开发环境（Docker Compose）
- 设计数据库ER图、接口文档初稿
- 资料准备：UI风格参考、接口规范、表结构设计

### 2. 基础框架搭建（1周）
- 前端：初始化React项目，搭建基础路由、布局、主题
- 后端：初始化Flask项目，配置SQLAlchemy、JWT、Celery、日志、配置管理
- 数据库：初始化PostgreSQL库，完成基础表结构迁移脚本
- 搭建本地开发环境与基础自动化测试

### 3. 用户与权限模块开发（1周）
- 商家注册、登录、JWT鉴权、用户信息管理
- 子账号管理、权限分配、角色管理
- 前端登录/注册/个人中心页面开发
- 单元测试与接口联调

### 4. 商品与库存管理模块开发（2周）
- 商品增删改查、批量导入导出（异步任务）
- 库存实时维护、库存盘点、库存告警设置
- 前端商品、库存、告警页面开发
- 单元测试、接口联调、批量/导入导出功能测试

### 5. 出入库与订单管理模块开发（2周）
- 出入库单录入、明细查询、批量出入库（异步任务）
- 订单录入、订单统计、报表导出（异步任务）
- 前端出入库、订单、报表页面开发
- 单元测试、接口联调、报表导出功能测试

### 6. 付费功能与系统消息模块开发（1周）
- 付费套餐、支付集成、功能开关、续费逻辑
- 系统消息、告警推送、操作日志模块开发
- 前端付费中心、系统消息、操作日志页面开发
- 单元测试、接口联调、支付与消息推送测试

### 7. 集成测试与优化（1周）
- 全流程集成测试，修复bug与性能优化
- 安全性测试、权限校验、异常处理完善
- 前端UI细节优化、移动端适配测试
- 数据库索引与慢查询优化

### 8. 上线准备与部署（1周）
- 生产环境部署脚本与配置完善
- 备份、监控、日志、告警配置
- 生产环境数据初始化与演练
- 项目文档、用户手册、运维手册整理

### 9. 里程碑与关键节点
- 需求评审、技术评审、UI评审、接口联调、集成测试、预上线、正式上线
- 每阶段结束进行阶段性回顾与风险评估

### 10. 所需资料与协作建议
- 需求文档、接口文档、ER图、UI原型、测试用例、部署手册
- 建议采用敏捷开发，每周例会同步进度，及时调整计划

### 11. 交付物
- 完整的前后端代码、数据库脚本、自动化测试用例
- 部署脚本、配置文件、用户与运维手册、接口文档

---

如需详细的 Flask 项目结构、依赖推荐或接口实现示例，可随时补充！ 